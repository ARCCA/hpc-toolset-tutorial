#!/bin/bash

set -e

trap 'ret=$?; test $ret -ne 0 && printf "failed\n\n" >&2; exit $ret' EXIT

log_info() {
  printf "\n\e[0;35m $1\e[0m\n\n"
}

log_info "*** Resetting XDMoD Installation ***"

log_info "Resetting Database"
for filename in /srv/xdmod/backups/*.sql; do
  db=$(basename $filename .sql)
  echo "Restoring $db"
  mysql -h mysql "$db" < "$filename"
done

log_info "Resetting Configuration Files"
tar -xvfz /srv/xdmod/xdmod-config.tar.gz -C /